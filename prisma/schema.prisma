// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  binaryTargets = ["native", "rhel-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"

}



model User {
  id              String    @id @default(cuid())
  fullName        String
  email           String    @unique   
  password        String
  role            UserRole  @default(USER)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  // Relations
  profile         Profile?
  hostedEvents    Event[]        @relation("HostedEvents")
  joinedEvents    Participant[]  @relation("UserParticipants")
  reviewsWritten  Review[]       @relation("UserReviews")
  payments        Payment[]
}

model Profile {
  id        String   @id @default(cuid())
  userId    String   @unique
  bio       String?  
  image     String?
  location  String?
  interests String[] @default([])

  user      User     @relation(fields: [userId], references: [id])
}

// ------------------------------------------------------
// EVENT MODEL
// ------------------------------------------------------

model Event {
  id              String        @id @default(cuid())
  hostId          String
  title           String
  category        String
  description     String
  image           String?
  date            DateTime
  location        String
  requiredMin     Int
  requiredMax     Int
  joiningFee      Float         @default(0)
  status          EventStatus   @default(OPEN)

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  host            User          @relation("HostedEvents", fields: [hostId], references: [id])
  participants    Participant[] @relation("EventParticipants")
  reviews         Review[]
  payments        Payment[]
}

// ------------------------------------------------------
// PARTICIPANTS MODEL (Event Members)
// ------------------------------------------------------

model Participant {
  id        String   @id @default(cuid())
  eventId   String
  userId    String
  joinedAt  DateTime @default(now())

  // Relations
  event     Event    @relation("EventParticipants", fields: [eventId], references: [id])
  user      User     @relation("UserParticipants", fields: [userId], references: [id])

  @@unique([eventId, userId]) 
}

// ------------------------------------------------------
// REVIEWS MODEL (Host Reviews)
// ------------------------------------------------------

model Review {
  id        String   @id @default(cuid())
  eventId   String
  userId    String     // review written by user
  rating    Int        // 1â€“5
  comment   String?
  createdAt DateTime    @default(now())

  // Relations
  event     Event      @relation(fields: [eventId], references: [id])
  user      User       @relation("UserReviews", fields: [userId], references: [id])
}

// ------------------------------------------------------
// PAYMENT MODEL
// ------------------------------------------------------

model Payment {
  id          String        @id @default(cuid())
  eventId     String
  userId      String
  amount      Float
  status      PaymentStatus @default(PENDING)
  provider    String        // Stripe, AmarPay, SSLCommerz
  txnId       String?       // gateway reference
  createdAt   DateTime      @default(now())

  // Relations
  event       Event @relation(fields: [eventId], references: [id])
  user        User  @relation(fields: [userId], references: [id])
}